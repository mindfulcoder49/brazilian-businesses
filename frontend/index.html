<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Brazilian Business Finder â€” Boston</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <header>
    <h1>ğŸ‡§ğŸ‡· Brazilian Business Finder â€” Boston Metro</h1>
    <div id="status-bar">
      <span id="status-indicator" class="status-idle">â— Idle</span>
      <span id="stats-summary"></span>
    </div>
  </header>

  <main>
    <!-- Left panel: Controls + Log stream -->
    <section class="panel" id="left-panel">

      <div class="card" id="controls-card">
        <h2>Phase 1 â€” Search <span class="tier-badge tier-free">IDs Only Â· FREE</span></h2>
        <div class="button-row">
          <button id="btn-start" class="btn btn-primary">â–¶ Start Run</button>
          <button id="btn-stop" class="btn btn-danger" disabled>â–  Stop</button>
          <button id="btn-refresh" class="btn btn-secondary">â†» Refresh</button>
        </div>
        <div id="run-info" class="run-info hidden"></div>
      </div>

      <div class="card" id="enrich-card">
        <h2>Phase 2 â€” Enrich <span class="tier-badge tier-pro">Pro Details Â· 5k free/mo</span></h2>
        <p class="enrich-desc">Fetch Place Details for every unique candidate â€” name, address, type, coordinates.</p>
        <div class="button-row">
          <button id="btn-enrich" class="btn btn-primary">â¬† Enrich All Pending</button>
        </div>
        <div id="enrich-status" class="run-info">
          <span id="stat-enriched">â€”</span> enriched &nbsp;/&nbsp; <span id="stat-pending">â€”</span> pending &nbsp;/&nbsp; <span id="stat-total-e">â€”</span> total
        </div>
      </div>

      <div class="card" id="score-card">
        <h2>Phase 3 â€” Score <span class="tier-badge tier-openai">OpenAI Â· batched Ã—10</span></h2>
        <p class="enrich-desc">Rate each enriched place 0â€“100 for Brazilian likelihood. Conservative scoring â€” reduces false positives.</p>
        <div class="button-row">
          <button id="btn-score" class="btn btn-primary">â­ Score All Pending</button>
          <a href="/" class="btn btn-secondary">ğŸ—º View Map</a>
        </div>
        <div id="score-status" class="run-info">
          <span id="stat-scored">â€”</span> scored &nbsp;Â·&nbsp;
          <span id="stat-high">â€”</span> high (â‰¥75) &nbsp;Â·&nbsp;
          <span id="stat-score-pending">â€”</span> pending
        </div>
      </div>

      <div class="card" id="stats-card">
        <h2>Search Stats <span class="tier-note">(current run)</span></h2>
        <div id="stats-grid" class="stats-grid">
          <div class="stat-box"><div class="stat-value" id="stat-queries">â€”</div><div class="stat-label">Queries Run</div></div>
          <div class="stat-box"><div class="stat-value" id="stat-results">â€”</div><div class="stat-label">IDs Returned</div></div>
          <div class="stat-box"><div class="stat-value" id="stat-candidates">â€”</div><div class="stat-label">Unique IDs</div></div>
          <div class="stat-box"><div class="stat-value" id="stat-dupes">â€”</div><div class="stat-label">Dupes Dropped</div></div>
        </div>
      </div>

      <div class="card" id="log-card">
        <div class="card-header">
          <h2>Live Log</h2>
          <label class="toggle-label">
            <input type="checkbox" id="log-autoscroll" checked /> Auto-scroll
          </label>
          <select id="log-level-filter">
            <option value="">All levels</option>
            <option value="INFO">INFO</option>
            <option value="WARN">WARN</option>
            <option value="ERROR">ERROR</option>
            <option value="DEBUG">DEBUG</option>
          </select>
          <button class="btn btn-secondary btn-sm" id="btn-clear-log">Clear</button>
        </div>
        <div id="log-stream"></div>
      </div>
    </section>

    <!-- Right panel: Candidates table -->
    <section class="panel" id="right-panel">
      <div class="card" id="candidates-card">
        <div class="card-header">
          <h2>Candidates <span id="candidate-count" class="badge">0</span></h2>
          <input type="text" id="candidate-filter" placeholder="Filter by name or addressâ€¦" />
          <button class="btn btn-secondary btn-sm" id="btn-export">â†“ Export CSV</button>
        </div>
        <div id="candidates-table-wrap">
          <table id="candidates-table">
            <thead>
              <tr>
                <th data-sort="display_name">Name â†•</th>
                <th data-sort="formatted_address">Address â†•</th>
                <th data-sort="primary_type">Type â†•</th>
                <th data-sort="brazil_score">Score â†•</th>
                <th data-sort="hit_count">Hits â†•</th>
                <th>Sources</th>
                <th>Map</th>
              </tr>
            </thead>
            <tbody id="candidates-tbody"></tbody>
          </table>
          <div id="no-candidates" class="empty-state">No candidates yet. Start a run to begin searching.</div>
        </div>
      </div>
    </section>
  </main>

  <script src="/static/app.js"></script>
</body>
</html>
